import streamlit as st
import pandas as pd
import re

conversion_list = [
    ("æœ‰ã‚Š", "ã‚ã‚Š"), ("æœ‰ã‚‹", "ã‚ã‚‹"), ("è²´æ–¹", "ã‚ãªãŸ"), ("æ­¤æ–¹", "ã“ã¡ã‚‰"), ("å…¶æ–¹", "ãã¡ã‚‰"),
    ("è¨€ã†", "ã„ã†"), ("è‡´ã™", "ã„ãŸã™"), ("é ‚ã", "ã„ãŸã ã"), ("é ‚ã", "ã„ãŸã ã"),
    ("ã‚¦ã‚£ãƒ«ã‚¹", "ã‚¦ã‚¤ãƒ«ã‚¹"), ("ã‚¦ã‚¨ãƒ«ã‚«ãƒ ãƒ‡ã‚¤", "ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ‡ã‚¤"), ("ä¼ºã†", "ã†ã‹ãŒã†"),
    ("ãŠè©±ã—", "ãŠè©±"), ("åŠã³", "ãŠã‚ˆã³"), ("å½¢", "ã‹ãŸã¡"), ("é ‘å¼µã‚‹", "ãŒã‚“ã°ã‚‹"),
    ("ä¸‹ã•ã„", "ãã ã•ã„"), ("ä¸‹ã•ã‚‹", "ãã ã•ã‚‹"), ("äº‹", "ã“ã¨"), ("å­ä¾›", "å­ã©ã‚‚"),
    ("é ƒ", "ã“ã‚"), ("æ§˜ã€…", "ã•ã¾ã–ã¾"), ("æ›´ã«", "ã•ã‚‰ã«"), ("å…¨ã¦", "ã™ã¹ã¦"),
    ("ã™ã‚‹æ§˜", "ã™ã‚‹ã‚ˆã†"), ("ä½†ã—", "ãŸã ã—"), ("é”", "ãŸã¡"), ("ç‚º", "ãŸã‚"),
    ("å‡ºæ¥ã‚‹", "ã§ãã‚‹"), ("é€šã‚Š", "ã¨ãŠã‚Š"), ("æ™‚", "ã¨ã"), ("æ‰€", "ã¨ã“ã‚"),
    ("å…ã«è§’", "ã¨ã«ã‹ã"), ("å‹é”", "å‹ã ã¡"), ("å…±ã«", "ã¨ã‚‚ã«"),
    ("å–çµ„ã‚€", "å–ã‚Šçµ„ã‚€"), ("å–çµ„ã¿", "å–ã‚Šçµ„ã¿"), ("ç„¡ã„", "ãªã„"),
    ("å°š", "ãªãŠ"), ("ç­‰", "ãªã©"), ("ä¸¦ã³ã«", "ãªã‚‰ã³ã«"),
    ("ä¸€äººä¸€äºº", "ä¸€äººã²ã¨ã‚Š"), ("ã²ã¨ã‚Šã²ã¨ã‚Š", "ä¸€äººã²ã¨ã‚Š"),
    ("æ–¹", "ã»ã†"), ("æ¬²ã—ã„", "ã»ã—ã„"), ("å…ˆãš", "ã¾ãš"), ("åˆ", "ã¾ãŸ"),
    ("åˆã¯", "ã¾ãŸã¯"), ("å…¨ã", "ã¾ã£ãŸã"), ("è‡ªã‚‰", "ã¿ãšã‹ã‚‰"),
    ("ç„¡é§„", "ã‚€ã "), ("ç„¡ç†çŸ¢ç†", "ã‚€ã‚Šã‚„ã‚Š"), ("è‹¥ã—ãã¯", "ã‚‚ã—ãã¯"),
    ("æŒã¤", "ã‚‚ã¤"), ("æœ€ã‚‚", "ã‚‚ã£ã¨ã‚‚"), ("ã®å…ƒ", "ã®ã‚‚ã¨"), ("ã®ä¸‹", "ã®ã‚‚ã¨"),
    ("è€…", "ã‚‚ã®"), ("ç‰©", "ã‚‚ã®"), ("è‰¯ã„", "ã‚ˆã„"), ("è‰¯ã‹ã£ãŸ", "ã‚ˆã‹ã£ãŸ"),
    ("å®œã—ã", "ã‚ˆã‚ã—ã"), ("åˆ†ã‹ã‚‹", "ã‚ã‹ã‚‹"), ("zoom", "Zoom"),
    ("çˆ¶å…„", "ä¿è­·è€…"), ("å…„å¼Ÿ", "å…„å¼Ÿå§‰å¦¹")
]

exceptions = {
    "äº‹": "ã€è‡ªåˆ†äº‹ã€ã€å‡ºæ¥äº‹ã€ãªã©ã¯ä¾‹å¤–ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
    "æ™‚": "åè©ã¨ã—ã¦ã®ã€æ™‚ã€ã¯æ¼¢å­—ãŒé©åˆ‡ãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
    "æ–¹": "æ–¹è§’ã‚’è¡¨ã™å ´åˆã¯æ¼¢å­—ã€æ¯”è¼ƒã®å ´åˆã¯ã²ã‚‰ãŒãªãŒæœ›ã¾ã—ã„ã§ã™ã€‚"
}

# -----------------------------
# UI
# -----------------------------
st.title("è¡¨è¨˜ã‚†ã‚Œãƒã‚§ãƒƒã‚¯ãƒ„ãƒ¼ãƒ«")
st.write("æ–‡ç« ã‚’ä¸‹ã®ãƒœãƒƒã‚¯ã‚¹ã«è²¼ã‚Šä»˜ã‘ã¦ã€è¡¨è¨˜ã®ã‚†ã‚Œã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã—ã‚‡ã†ã€‚")

text_input = st.text_area("æ–‡ç« ã‚’å…¥åŠ›ï¼š", height=300)

if st.button("ãƒã‚§ãƒƒã‚¯"):
    if not text_input.strip():
        st.warning("æ–‡ç« ãŒç©ºã§ã™ï¼")
    else:
        hits = []
        highlighted = text_input

                # æ•°å­—ã®ãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯ï¼ˆ1æ¡ã¯å…¨è§’ã€2æ¡ä»¥ä¸Šã¯åŠè§’ï¼‰
        digit_issues = []
        for match in re.finditer(r'\d+', text_input):
            num = match.group()
            if len(num) == 1:
                digit_issues.append(f"1æ¡ã®æ•°å­—ã€Œ{num}ã€ã¯å…¨è§’ãŒæœ›ã¾ã—ã„ã§ã™ã€‚")
            elif len(num) >= 2 and any(c in "ï¼ï¼‘ï¼’ï¼“ï¼”ï¼•ï¼–ï¼—ï¼˜ï¼™" for c in num):
                digit_issues.append(f"2æ¡ä»¥ä¸Šã®æ•°å­—ã€Œ{num}ã€ã¯åŠè§’ãŒæœ›ã¾ã—ã„ã§ã™ã€‚")

        # ä¸‡ä»¥ä¸Šã®æ•°å­—ã«æ¼¢æ•°å­—ãƒã‚§ãƒƒã‚¯
        man_issues = []
        for match in re.finditer(r'\d+ä¸‡', text_input):
            man_issues.append(f"ã€Œ{match.group()}ã€ã¯æ¼¢æ•°å­—ã§ã®è¡¨è¨˜ï¼ˆä¾‹ï¼šåä¸‡ï¼‰ãŒæœ›ã¾ã—ã„ã§ã™ã€‚")


        for wrong, correct in conversion_list:
            if wrong in text_input:
                hits.append((wrong, correct))
                highlighted = re.sub(f"({re.escape(wrong)})", r"<mark>\\1</mark>", highlighted)

        st.markdown("### ğŸ” ãƒã‚¤ãƒ©ã‚¤ãƒˆçµæœ")
        st.markdown(highlighted, unsafe_allow_html=True)

        if hits:
            st.markdown("### âœ… è©²å½“è¡¨è¨˜ä¸€è¦§")
            df = pd.DataFrame(hits, columns=["é–“é•ã„", "æ­£ã—ã„è¡¨è¨˜"])
            st.dataframe(df, use_container_width=True)
        else:
            st.success("è¡¨è¨˜ã‚†ã‚Œã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸï¼")

        # æ•°å­—ãƒ«ãƒ¼ãƒ«ã®è­¦å‘Šè¡¨ç¤º
if digit_issues or man_issues:
    st.markdown("### âš ï¸ æ•°å­—ãƒ«ãƒ¼ãƒ«ã®æŒ‡æ‘˜")
    for msg in digit_issues + man_issues:
        st.warning(msg)


        # ä¾‹å¤–èªã®æ³¨æ„å–šèµ·
        st.markdown("### âš ï¸ æ³¨æ„ãŒå¿…è¦ãªèª")
        for word, note in exceptions.items():
            if word in text_input:
                st.warning(f"ã€{word}ã€ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š{note}")
